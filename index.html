<!DOCTYPE html>
<html lang="gu">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ркирк┐ркоркгрлВркХ рккркдрлНрк░ ркПркбрк┐ркЯрк░</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Gujarati:wght@400;600;800&display=swap" rel="stylesheet">
<style>
/* --- рдЖрдкрдХреА CSS рд╡рд╣реА рд░рдЦреА рдЧрдИ рд╣реИ --- */
:root {
  --canvas-w: 1080px;
  --canvas-h: 1530px;
}
* { box-sizing: border-box; font-family: "Noto Sans Gujarati", sans-serif; }
body {
  margin: 18px;
  background: #f0f3f6;
  color: #111;
  display: flex;
  flex-direction: column;
  align-items: center;
}
.controls {
  width: 100%;
  max-width: 420px;
  background: #fff;
  border-radius: 12px;
  padding: 14px;
  box-shadow: 0 8px 24px rgba(15, 15, 15, 0.08);
  margin-bottom: 20px;
}
.controls h2 { margin: 0 0 8px; font-size: 18px; font-weight: 800; }
.controls label { display: block; font-weight: 700; margin-top: 10px; font-size: 13px; }
.controls input {
  width: 100%;
  padding: 8px 10px;
  margin-top: 6px;
  border-radius: 8px;
  border: 1px solid #d6d6d6;
  font-size: 14px;
}
button { border: 0; padding: 10px 14px; border-radius: 8px; cursor: pointer; font-weight: 800; font-size: 14px; }
.primary { background: #111; color: #fff; transition: 0.3s; }
.primary:hover { background: #333; }
.ghost { background: #f3f4f6; transition: 0.3s; }
.ghost:hover { background: #e5e7eb; }

.canvas-wrap {
  width: 100%;
  max-width: var(--canvas-w);
  aspect-ratio: 1080 / 1530;
  position: relative;
  display: none;
  margin-bottom: 20px;
}
.poster {
  width: 100%;
  height: 88%;
  background: url('new-bg.jpg') no-repeat center/cover;
  border-radius: 12px;
  box-shadow: 0 14px 40px rgba(0, 0, 0, 0.25);
  position: relative;
}
.overlay { position: absolute; inset: 0; pointer-events: none; }
.center-frame {
  position: absolute;
  top: 13.1%;
  left: 38%;
  height: 22.2%;
  width: 26%;
  display: flex;
  align-items: center;
  justify-content: center;
  background: #fff;
  border-radius: 10px;
  overflow: hidden;
}
.center-frame img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}
.text-overlay {
  position: absolute;
  font-weight: 700;
  color: #ff0000;
  white-space: pre-wrap;
  word-break: break-word;
  font-family: monospace;
  line-height: 1.3;
  text-align: left;
}
#nameOut     { top: 34.5%;
                left: 38%;
                font-size: 2.5vw; 
              }
              
#villageOut  { top: 38.9%;
                left: 27%;
                font-size: 2.3vw; 
              }

#talukaOut   { top: 38.8%;
                left: 58%;
                font-size: 2.3vw;
              } 
              

#districtOut { top: 43.1%;
                left: 24%;
                font-size: 2.3vw;
              }

#mobileOut   { top: 43%;
                left: 58%;
                font-size: 2.3vw; 
              }

#businessOut { top: 69.9%;
                left: 66%;
                font-size: 2.3vw;
                max-width: 35%; 
                text-align: center; 
              }

#dateOut     { top: 88%;
                left: 32%;
                font-size: 2.3vw;
              }

#goToFormBtn {
  display: none;
  margin-bottom: 20px;
  background: #2563eb;
  color: white;
  border: none;
  font-weight: bold;
  padding: 10px 16px;
  border-radius: 8px;
  cursor: pointer;
  transition: 0.3s;
}
#goToFormBtn:hover { background: #1e40af; }
#warningModal {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.7);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 9999;
}
#warningBox {
  background: white;
  padding: 20px 30px;
  border-radius: 12px;
  max-width: 400px;
  text-align: center;
  box-shadow: 0 8px 24px rgba(0,0,0,0.3);
}
#warningBox h2 {
  margin-bottom: 12px;
  font-size: 20px;
  font-weight: bold;
  color:#b91c1c;
}
#closeWarningBtn {
  background:#2563eb;
  color:white;
  border:none;
  padding:10px 18px;
  border-radius:8px;
  font-weight:bold;
  cursor:pointer;
}
#closeWarningBtn:hover { background:#1e40af; }
</style>
</head>
<body>

<!-- тЪая╕П Warning Modal -->
<div id="warningModal">
  <div id="warningBox" style="background:#111; color:white;">
    <h2 style="color:#facc15;">ЁЯЩПркЦрк╛рк╕ рк╡рк┐ркиркВркдрлАЁЯЩП</h2>
    <p id="warningText" style="font-size:15px; line-height:1.6; font-weight:bold; color:white;">
      рк╢рлНрк░рлА рк╕рлЛркирк▓ рк╕рлЗркирк╛ ркирлЛ рккрлЛрк╕рлНркЯрк░ ркмркирк╛рк╡рк┐ркпрк╛ ркмрк╛ркж рк╢рлНрк░рлА рк╕рлЛркирк▓ рк╕рлЗркирк╛ ркЧрлБркЬрк░рк╛ркд ркирлА id рк╕рк╛ркерлЗ ркХрлЛрк▓рлЛркмрлНрк░рлЗрк╢рки ркХрк░рк╡рк╛ ркирлБркВ рк░рк╣рлЗрк╕рлЗ ркЬрлЛ ркирк╣рлАркВ рк╣рлЛркп ркдрлЛ ркдркорлЗ рк╕ркнрлНркп ркЧркгрк╛рк╕рлЛ ркирк╣рлАркВ <br><br>
      <b style="color:red;">id: shree_sonal_sena_gujrat</b>
    </p>
    <button id="closeWarningBtn">OK, Continue</button>
  </div>
</div>

<div class="controls" id="formWrap">
  <h2>рккрлЛрк╕рлНркЯрк░ ркорк╛ркЯрлЗ рклрлЛрк░рлНрко</h2>
  <label>ркирк╛рко</label><input id="nameIn" type="text">
  <label>ркЧрк╛рко</label><input id="villageIn" type="text">
  <label>ркдрк╛рк▓рлБркХрлЛ</label><input id="talukaIn" type="text">
  <label>ркЬрк┐рк▓рлНрк▓рлЛ</label><input id="districtIn" type="text">
  <label>ркорлЛркмрк╛ркИрк▓ ркиркВркмрк░</label><input id="mobileIn" type="text">
  <label>рк╡рлНркпрк╡рк╕рк╛ркп</label><input id="businessIn" type="text">
  <label>ркдрк╛рк░рлАркЦ</label><input id="dateIn" type="date">
  <label>рккрлНрк░рлЛрклрк╛ркЗрк▓ рклрлЛркЯрлЛ</label><input id="centerImgIn" type="file" accept="image/*">
  <div style="margin-top:12px;">
    <button id="applyBtn" class="primary">Apply</button>
    <button id="resetBtn" class="ghost">Reset</button>
    <a href="data.html" target="_blank">
      <button type="button" class="ghost">View Stored Data</button>
    </a>
  </div>
</div>

<button id="goToFormBtn">Go to Form</button>

<div class="canvas-wrap" id="posterWrap">
  <div id="poster" class="poster">
    <div class="overlay">
      <div class="center-frame">
        <img id="centerImg" src="" alt="">
      </div>
      <pre id="nameOut" class="text-overlay"></pre>
      <pre id="villageOut" class="text-overlay"></pre>
      <pre id="talukaOut" class="text-overlay"></pre>
      <pre id="districtOut" class="text-overlay"></pre>
      <pre id="mobileOut" class="text-overlay"></pre>
      <pre id="businessOut" class="text-overlay"></pre>
      <pre id="dateOut" class="text-overlay"></pre>
    </div>
  </div>
</div>

<button id="downloadBtn" class="primary" style="display:none">Download HD PNG</button>

<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script>
const get = id => document.getElementById(id);
function setText(id, value) { get(id).textContent = value; }
let uploadedImageBase64 = "";

// тЬЕ Save with image + timestamp (local + Google Sheets)
const saveData = () => {
  const formData = {
    name: get('nameIn').value,
    village: get('villageIn').value,
    taluka: get('talukaIn').value,
    district: get('districtIn').value,
    mobile: get('mobileIn').value,
    business: get('businessIn').value,
    date: formatDate(get('dateIn').value),
    image: uploadedImageBase64,
    timestamp: new Date().toLocaleString()
  };

  // Local storage
  let storedData = JSON.parse(localStorage.getItem('posterData')) || [];
  storedData.push(formData);
  localStorage.setItem('posterData', JSON.stringify(storedData));

  // Google Sheets API call
  fetch("https://script.google.com/macros/s/AKfycbwkWw5xeU_h6IEN0mCxcUJ2hFXhRkbrMLrF240Dqf-4DapPLR9U_Q3mSsHd0Xp14Pot/exec", {
    method: "POST",
    mode: "no-cors",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(formData)
  }).then(() => {
    console.log("тЬЕ Data sent to Google Sheet");
  }).catch(err => console.error("тЭМ Error:", err));
};

const apply = () => {
  saveData();
  setText('nameOut', get('nameIn').value);
  setText('villageOut', get('villageIn').value);
  setText('talukaOut', get('talukaIn').value);
  setText('districtOut', get('districtIn').value);
  setText('mobileOut', get('mobileIn').value);
  setText('businessOut', get('businessIn').value);
  setText('dateOut', formatDate(get('dateIn').value));
  get('formWrap').style.display = 'none';
  get('posterWrap').style.display = 'block';
  get('downloadBtn').style.display = 'inline-block';
  get('goToFormBtn').style.display = 'inline-block';
};

const formatDate = iso => {
  if (!iso) return '';
  const [y, m, d] = iso.split('-');
  return `${d}-${m}-${y}`;
};

get('centerImgIn').addEventListener('change', e => {
  const file = e.target.files[0];
  if (file) {
    const r = new FileReader();
    r.onload = ev => {
      uploadedImageBase64 = ev.target.result;
      get('centerImg').src = uploadedImageBase64;
    };
    r.readAsDataURL(file);
  }
});

get('applyBtn').addEventListener('click', apply);
get('resetBtn').addEventListener('click', () => location.reload());

// тЬЕ Download HD PNG same as before
get('downloadBtn').addEventListener('click', async () => {
  const posterEl = get('poster');
  const images = posterEl.querySelectorAll('img');
  await Promise.all(Array.from(images).map(img => {
    if (!img.complete) {
      return new Promise(resolve => { img.onload = img.onerror = resolve; });
    }
  }));

  const overlayCanvas = await html2canvas(posterEl, {
    backgroundColor: null,
    useCORS: true,
    scale: 2
  });

  const bgImg = new Image();
  bgImg.crossOrigin = "anonymous";
  bgImg.src = "new-bg.jpg";  // рдирдпрд╛ background
  bgImg.onload = () => {
  const finalCanvas = document.createElement('canvas');
  finalCanvas.width = bgImg.naturalWidth;
  finalCanvas.height = bgImg.naturalHeight;
  const ctx = finalCanvas.getContext('2d');
  ctx.drawImage(bgImg, 0, 0, finalCanvas.width, finalCanvas.height);
  ctx.drawImage(overlayCanvas, 0, 0, finalCanvas.width, finalCanvas.height);
  finalCanvas.toBlob(blob => {
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'nimnuk-patra-2k.png';
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
  }, 'image/png', 1);
};


get('goToFormBtn').addEventListener('click', () => {
  get('posterWrap').style.display = 'none';
  get('downloadBtn').style.display = 'none';
  get('goToFormBtn').style.display = 'none';
  get('formWrap').style.display = 'block';
});

// тЪая╕П Warning Modal Close
document.getElementById("closeWarningBtn").addEventListener("click", () => {
  document.getElementById("warningModal").style.display = "none";
});
</script>
</body>
</html>
